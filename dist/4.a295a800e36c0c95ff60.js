(window.webpackJsonp=window.webpackJsonp||[]).push([[4,11],{220:function(e,t,a){"use strict";a.r(t);var l=a(0),o=a.n(l),n=a(19),s=a(2),r=a(9),i=a(5),u=a.n(i),c=a(20),d=a(14),m=a(11),v=a(12),p=a(69);t.default=function(e){const t=Object(l.useContext)(m.a),a=Object(l.useContext)(v.a),i={title:{value:"",hasErrors:!1,message:""},body:{value:"",hasErrors:!1,message:""},isFetching:!0,isSaving:!1,id:Object(s.f)().postid,sendCount:0,notFound:!1},[b,y]=Object(d.b)((function(e,t){switch(t.type){case"fetchComplete":return e.title.value=t.value.title,e.body.value=t.value.body,void(e.isFetching=!1);case"notFound":return void(e.notFound=!0);case"titleChange":return e.title.value=t.value,e.title.hasErrors=!1,void(e.title.message="");case"bodyChange":return e.body.value=t.value,e.body.hasErrors=!1,void(e.body.message="");case"submitRequest":return void(e.title.hasErrors||e.body.hasErrors||e.sendCount++);case"saveRequestStarted":return void(e.isSaving=!0);case"saveRequestFinished":return void(e.isSaving=!1);case"titleValidation":return void(t.value.trim()||(e.title.hasErrors=!0,e.title.message="You must provide a title"));case"bodyValidation":return void(t.value.trim()||(e.body.hasErrors=!0,e.body.message="You must provide a content"))}}),i);//! loader
//! fetch post data from server
return Object(l.useEffect)(()=>{const e=u.a.CancelToken.source();return async function(){try{const a=await u.a.get("/post/"+b.id,{cancelToken:e.token});a.data?(y({type:"fetchComplete",value:a.data}),t.user.username!=a.data.author.username&&y({type:"notFound"})):y({type:"notFound"})}catch(e){console.log("There was a problem")}}(),()=>{e.cancel()}},[]),Object(l.useEffect)(()=>{if(b.sendCount){y({type:"saveRequestStarted"});const e=u.a.CancelToken.source();return async function(){try{await u.a.post(`/post/${b.id}/edit`,{title:b.title.value,body:b.body.value,token:t.user.token},{cancelToken:e.token});console.log("Post updated"),y({type:"saveRequestFinished"}),a({type:"flashMessage",value:"Congrats, you've successfully updated a post"})}catch(e){console.log("There was a problem here")}}(),()=>{e.cancel()}}},[b.sendCount]),b.notFound?o.a.createElement(p.default,null):b.isFetching?o.a.createElement(n.a,{title:"Edit post"},o.a.createElement(c.a,null)):o.a.createElement(n.a,{title:"Edit post"},o.a.createElement(r.b,{to:"/post/"+b.id,className:"small font-weight-bold"},"Â« Back to the post"),o.a.createElement("form",{className:"mt-3",onSubmit://! update post
async function(e){e.preventDefault(),y({type:"titleValidation",value:b.title.value}),y({type:"bodyValidation",value:b.body.value}),y({type:"submitRequest"})}},o.a.createElement("div",{className:"form-group"},o.a.createElement("label",{htmlFor:"post-title",className:"text-muted mb-1"},o.a.createElement("small",null,"Title")),o.a.createElement("input",{autoFocus:!0,name:"title",id:"post-title",className:"form-control form-control-lg form-control-title",type:"text",placeholder:"",autoComplete:"off",value:b.title.value,onChange:e=>{y({type:"titleChange",value:e.target.value})},onBlur:e=>y({type:"titleValidation",value:e.target.value})}),b.title.hasErrors&&o.a.createElement("div",{className:"alert alert-danger small liveValidateMessage"},b.title.message)),o.a.createElement("div",{className:"form-group"},o.a.createElement("label",{htmlFor:"post-body",className:"text-muted mb-1 d-block"},o.a.createElement("small",null,"Body Content")),o.a.createElement("textarea",{name:"body",id:"post-body",className:"body-content tall-textarea form-control",type:"text",value:b.body.value,onChange:e=>y({type:"bodyChange",value:e.target.value}),onBlur:e=>y({type:"bodyValidation",value:e.target.value})}),b.body.hasErrors&&o.a.createElement("div",{className:"alert alert-danger small liveValidateMessage"},b.body.message)),o.a.createElement("button",{className:"btn btn-primary",disabled:b.isSaving},b.isSaving?"Saving...":"Update the post")))}},69:function(e,t,a){"use strict";a.r(t);var l=a(0),o=a.n(l),n=a(9),s=a(19);t.default=function(e){return o.a.createElement(s.a,{title:"Page not found"},o.a.createElement("div",{className:"text-center"},o.a.createElement("h2",null,"Whoops, can't find this page"),o.a.createElement("p",{className:"lead text-muted"},"You can always visit the ",o.a.createElement(n.b,{to:"/"},"homepage"))))}}}]);